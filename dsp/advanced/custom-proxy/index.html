
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../data/working-with-dicom/">
      
      
        <link rel="next" href="../email/">
      
      
      <link rel="icon" href="../../../imgs/logos/AIDA-icon-6.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Setting up a custom HTTP Proxy - AIDA Data Hub Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-a-custom-http-proxy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="AIDA Data Hub Documentation" class="md-header__button md-logo" aria-label="AIDA Data Hub Documentation" data-md-component="logo">
      
  <img src="../../../imgs/logos/aida-icon-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AIDA Data Hub Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setting up a custom HTTP Proxy
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/NBISweden/aida-datahub-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    NBISweden/aida-datahub-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="AIDA Data Hub Documentation" class="md-nav__button md-logo" aria-label="AIDA Data Hub Documentation" data-md-component="logo">
      
  <img src="../../../imgs/logos/aida-icon-logo.png" alt="logo">

    </a>
    AIDA Data Hub Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/NBISweden/aida-datahub-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    NBISweden/aida-datahub-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../data/data-sharing-request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Requesting access to AIDA Data Hub dataset through REMS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../data/download-dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Download a dataset from AIDA Nextcloud using rclone
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../data/working-with-dicom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with DICOM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data science platform
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Data science platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Setting up a custom HTTP Proxy
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Setting up a custom HTTP Proxy
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#set-up-privoxy-on-the-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Set up privoxy on the VM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-ssh" class="md-nav__link">
    <span class="md-ellipsis">
      Configure SSH
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-remote-programs" class="md-nav__link">
    <span class="md-ellipsis">
      Configure remote programs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure remote programs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-alias-for-temporarily-switching-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Creating alias for temporarily switching proxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-proxy-settings-persistent" class="md-nav__link">
    <span class="md-ellipsis">
      Making Proxy Settings Persistent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disabling-privoxy" class="md-nav__link">
    <span class="md-ellipsis">
      Disabling Privoxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Disabling Privoxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-apt-to-use-privoxy" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring APT to Use Privoxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-proxy-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Proxy Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docker Proxy Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-wide-docker-proxy-method-1" class="md-nav__link">
    <span class="md-ellipsis">
      System-Wide Docker Proxy (Method 1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-client-configuration-method-2" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Client Configuration (Method 2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-build-and-run-with-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Build and Run with Proxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-proxy-inside-docker-container" class="md-nav__link">
    <span class="md-ellipsis">
      Using Proxy Inside Docker Container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending emails from DSP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/gpu-iaas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPU IaaS with custom software and data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/basic-setup-network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic setup for new VMs to be able to access external resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/exposing-https-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exposing HTTPS services in DSP to the outside
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/first-login/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First login to DSP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/life-science-login/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Life Science federation login
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/vm-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up and logging into a machine in DSP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#set-up-privoxy-on-the-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Set up privoxy on the VM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-ssh" class="md-nav__link">
    <span class="md-ellipsis">
      Configure SSH
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-remote-programs" class="md-nav__link">
    <span class="md-ellipsis">
      Configure remote programs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure remote programs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-alias-for-temporarily-switching-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Creating alias for temporarily switching proxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-proxy-settings-persistent" class="md-nav__link">
    <span class="md-ellipsis">
      Making Proxy Settings Persistent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disabling-privoxy" class="md-nav__link">
    <span class="md-ellipsis">
      Disabling Privoxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Disabling Privoxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-apt-to-use-privoxy" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring APT to Use Privoxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-proxy-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Proxy Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docker Proxy Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-wide-docker-proxy-method-1" class="md-nav__link">
    <span class="md-ellipsis">
      System-Wide Docker Proxy (Method 1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-client-configuration-method-2" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Client Configuration (Method 2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-build-and-run-with-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Build and Run with Proxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-proxy-inside-docker-container" class="md-nav__link">
    <span class="md-ellipsis">
      Using Proxy Inside Docker Container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="setting-up-a-custom-http-proxy">Setting up a custom HTTP Proxy</h1>
<p>By default, the Virtual Machines (VMs) on the Data Science Platform (DSP) can
make HTTP requests to the outside world only by going through an inspecting
proxy. To make the default configuration of DSP secure, this proxy has a strict
list of allowed resources that internal machines can access. For some projects,
the default is too strict, and one way of getting around it is to set up your
own proxy for your VMs.</p>
<p>But do note that before doing so you must verify that it follows the overall
security guidelines for the current research project.</p>
<p>In this guide, we will set up a different proxy on a VM using <code>privoxy</code> and
tunnel HTTP requests through the connecting machine´s SSH connection.</p>
<p>As a curiosity, this builds a lot on functionality offered by OpenSSH and the
privoxy bits can in many cases be bypassed by referencing the SOCKS5 proxy
OpenSSH provides directly, e.g. by <code>http_proxy=socsk5h://127.0.0.1:3128</code>. But
while it has fairly wide support it's not universal, and adding privoxy to serve
as a http proxy will help with some of those - but if you just need a quick <code>apt
install</code> or similar, you can bypass that and use the socks proxy directly.</p>
<p><strong>Note that this will circumvent strict filtering and essentially allow any HTTP
request from your VM to be carried out (unless you explicitly add filtering on
your own machine or network).</strong></p>
<h2 id="set-up-privoxy-on-the-vm">Set up <code>privoxy</code> on the VM</h2>
<p><code>privoxy</code> is a simple web proxy which is provided in the base Ubuntu
repositories, this means that it will be easy to install it on Ubuntu-based VMs
on DSP since the default package repositories are in our allow lists. Install it
on your VM by running:</p>
<pre><code class="language-shell">sudo apt install privoxy
</code></pre>
<p>Now we need to configure it to forward requests using SOCKS5:</p>
<pre><code class="language-shell">echo 'forward-socks5  /  127.0.0.1:3128  .' | sudo tee -a /etc/privoxy/config
</code></pre>
<p>Restart <code>privoxy</code> to read the changes:</p>
<pre><code class="language-shell">sudo systemctl restart privoxy
</code></pre>
<p>Now disconnect from the VM (we need to add additional configurations to the SSH
client)</p>
<pre><code class="language-shell">exit
</code></pre>
<h2 id="configure-ssh">Configure SSH</h2>
<p>Above, we configured <code>privoxy</code> to forward HTTP requests to a SOCKS5 proxy on the
port <code>3128</code> on the machine where it´s running (i.e. the VM). We'll now make our
own connecting machine relaying the HTTP requests by telling our SSH client to
listen to this port on the remote host (VM) and tunnel traffic to our connecting
machine. We do this by using a "remote forward" connection. You can do this
"on-the-fly" when you connect to your machine using the flag <code>-R 3128</code>, but
it's more convenient to add this to your SSH config:</p>
<pre><code class="language-text">Host dsp-project
  HostName [VM_FLOATING_IP]
  User ubuntu
  ProxyJump dsp
  ServerAliveInterval 10
  RemoteForward 3128 localhost:3128

Host dsp
  Hostname dsp.aida.scilifelab.se
  User [MY_EMAIL]
</code></pre>
<p>The <code>RemoteForward 3128</code> is what sets up the reverse tunnel.</p>
<p>Now when you connect to your VM over SSH (e.g. <code>ssh dsp-project</code> in config
example above), SSH will forward any traffic connecting to the port 3128 on the
VM to our connecting machine and carry out the HTTP requests.</p>
<h2 id="configure-remote-programs">Configure remote programs</h2>
<p>By default, the VM is configured to use the DSP HTTP proxy. This is set up using
the environmental variables <code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code>, <code>http_proxy</code> and
<code>https_proxy</code>. We'll replace their values with the address of our <code>privoxy</code>
instance instead. By default it listens to port 8118 for requests, so we'll set
our environmental variables to this:</p>
<pre><code class="language-shell">export http_proxy=http://127.0.0.1:8118 https_proxy=http://127.0.0.1:8118
export HTTP_PROXY=http://127.0.0.1:8118 HTTPS_PROXY=http://127.0.0.1:8118
</code></pre>
<p>This changes the variables for the currently running shell (so just for your
current session). Once you have exported the variables, you should be able to
test that the proxy works by running (in the same shell):</p>
<pre><code class="language-shell">curl -v --proxy http://127.0.0.1:8118 https://example.com
</code></pre>
<p>Which should output an HTML document to you terminal; the HTMLlanding page of <code>example.com</code>.</p>
<h3 id="creating-alias-for-temporarily-switching-proxy">Creating alias for temporarily switching proxy</h3>
<p>We can add a shell alias if we want to temporarily set the environmental
variables:</p>
<pre><code class="language-shell">alias proxy='http_proxy=http://127.0.0.1:8118 https_proxy=http://127.0.0.1:8118 HTTP_PROXY=http://127.0.0.1:8118 HTTPS_PROXY=http://127.0.0.1:8118'
</code></pre>
<p>Then use it for specific commands:</p>
<pre><code class="language-shell">proxy pip3 install numpy   # Uses proxy
pip3 install numpy         # Does not use proxy
</code></pre>
<h3 id="making-proxy-settings-persistent">Making Proxy Settings Persistent</h3>
<p>The above exports of environmental variables only affect the shell you run it
in, and you might want your proxy to be used throughout your account.
To achieve that run the following:</p>
<pre><code class="language-shell">cat &gt;&gt; ~/.bashrc &lt;&lt; EOF

# Proxy settings
export http_proxy=http://127.0.0.1:8118
export https_proxy=http://127.0.0.1:8118
export HTTP_PROXY=http://127.0.0.1:8118
export HTTPS_PROXY=http://127.0.0.1:8118
EOF
</code></pre>
<p>Then reload your Bash configuration:</p>
<pre><code class="language-shell">source ~/.bashrc
</code></pre>
<h2 id="disabling-privoxy">Disabling Privoxy</h2>
<p>To remove the persistent settings from your <code>.bashrc</code>:</p>
<pre><code class="language-shell">sed -i \
    -e '/^# Proxy settings$/d' \
    -e '/^export http_proxy=http:\/\/127\.0\.0\.1:8118$/d' \
    -e '/^export https_proxy=http:\/\/127\.0\.0\.1:8118$/d' \
    -e '/^export HTTP_PROXY=http:\/\/127\.0\.0\.1:8118$/d' \
    -e '/^export HTTPS_PROXY=http:\/\/127\.0\.0\.1:8118$/d' \
    ~/.bashrc
</code></pre>
<p>To temporarily stop Privoxy:</p>
<pre><code class="language-shell">sudo systemctl stop privoxy
</code></pre>
<p>To disable Privoxy from starting on boot:</p>
<pre><code class="language-shell">sudo systemctl disable privoxy
</code></pre>
<p>To completely remove Privoxy:</p>
<pre><code class="language-shell">sudo apt remove privoxy
sudo apt autoremove
</code></pre>
<h3 id="configuring-apt-to-use-privoxy">Configuring APT to Use Privoxy</h3>
<p>While the default sources for APT are allowed in the DSP proxy, you might have
added additional package repositories, in which case they will likely be
blocked. You can tell APT to use privoxy instead by adding a proxy configuration
file:</p>
<ol>
<li><strong>Create an APT configuration file for the proxy:</strong></li>
</ol>
<p><code>shell
   sudo bash -c 'cat &gt; /etc/apt/apt.conf.d/80proxy &lt;&lt; EOF
   Acquire::http::Proxy "http://127.0.0.1:8118";
   Acquire::https::Proxy "http://127.0.0.1:8118";
   EOF'</code></p>
<ol>
<li><strong>Verify the configuration:</strong></li>
</ol>
<p><code>shell
   cat /etc/apt/apt.conf.d/80proxy</code></p>
<ol>
<li><strong>Test APT with the proxy:</strong></li>
</ol>
<p><code>shell
   sudo apt update</code></p>
<h2 id="docker-proxy-configuration">Docker Proxy Configuration</h2>
<h3 id="system-wide-docker-proxy-method-1">System-Wide Docker Proxy (Method 1)</h3>
<ol>
<li>Create or edit the Docker service configuration file:</li>
</ol>
<p><code>shell
   sudo mkdir -p /etc/systemd/system/docker.service.d/
   sudo bash -c 'cat &gt; /etc/systemd/system/docker.service.d/http-proxy.conf &lt;&lt; EOF
   [Service]
   Environment="HTTP_PROXY=http://127.0.0.1:8118"
   Environment="HTTPS_PROXY=http://127.0.0.1:8118"
   Environment="NO_PROXY=localhost,127.0.0.1,::1"
   Environment="no_proxy=localhost,127.0.0.1,::1"
   EOF'</code></p>
<ol>
<li>Reload the Docker daemon configuration:</li>
</ol>
<p><code>shell
   sudo systemctl daemon-reload
   sudo systemctl restart docker</code></p>
<ol>
<li>Verify the Docker proxy settings:</li>
</ol>
<p><code>shell
   sudo systemctl show --property=Environment docker</code></p>
<h3 id="docker-client-configuration-method-2">Docker Client Configuration (Method 2)</h3>
<p>For a user-specific Docker configuration:</p>
<pre><code class="language-shell">mkdir -p ~/.docker
cat &gt; ~/.docker/config.json &lt;&lt; EOF
{
 &quot;proxies&quot;:
 {
   &quot;default&quot;:
   {
     &quot;httpProxy&quot;: &quot;http://127.0.0.1:8118&quot;,
     &quot;httpsProxy&quot;: &quot;http://127.0.0.1:8118&quot;,
     &quot;noProxy&quot;: &quot;localhost,127.0.0.1,::1&quot;
   }
 }
}
EOF
</code></pre>
<h3 id="docker-build-and-run-with-proxy">Docker Build and Run with Proxy</h3>
<p>To make your proxy available during Docker build:</p>
<pre><code class="language-shell">docker build --network=host .
</code></pre>
<p>To run a container with host network (and thus access to your proxy):</p>
<pre><code class="language-shell">docker run -it --rm --network host ubuntu bash
</code></pre>
<h3 id="using-proxy-inside-docker-container">Using Proxy Inside Docker Container</h3>
<p>Inside the container, set up proxy configuration the
same way as we've done above in this guide:</p>
<pre><code class="language-shell"># Create an alias for temporary proxy usage
alias proxy='http_proxy=http://127.0.0.1:8118 https_proxy=http://127.0.0.1:8118 HTTP_PROXY=http://127.0.0.1:8118 HTTPS_PROXY=http://127.0.0.1:8118'

# Use proxy for specific commands
proxy pip3 install numpy   # Uses proxy
pip3 install numpy         # Does not use proxy

# Or set for the entire session
export http_proxy=http://127.0.0.1:8118 https_proxy=http://127.0.0.1:8118
export HTTP_PROXY=http://127.0.0.1:8118 HTTPS_PROXY=http://127.0.0.1:8118
pip3 install numpy         # Now uses proxy
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>